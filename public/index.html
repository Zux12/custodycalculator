<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Asianloop – Simple Custody Calculator</title>
<link rel="stylesheet" href="/styles.css">
<!-- SheetJS (for .xlsx export) -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" defer></script>
<script src="/app.js" defer></script>
</head>
<body>
  <!-- Light header so white-background logo blends nicely -->
  <div class="header">
    <div class="wrap">
      <img src="/logo.pjg" alt="Asianloop Logo">
      <div>
        <h1>Asianloop – Simple Custody Calculator</h1>
        <small>Corrected Volume (V<sub>corr</sub>) · Mass · Energy</small>
      </div>
      <div style="margin-left:auto;display:flex;gap:10px;align-items:center">
        <button id="btnInfo" class="btn" title="Disclaimers & Standards">ℹ️ Info & Standards</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <div class="title">Inputs <span class="pill">Saved in your browser</span></div>
      <div class="row">
        <div>
          <label>Measured Volume (V)</label>
          <input id="V" type="number" step="any" placeholder="e.g. 1000">
          <div class="hint">Units selectable at right</div>
        </div>
        <div>
          <label>Volume Unit</label>
          <select id="unitV">
            <option value="m3">m³</option>
            <option value="L">L</option>
            <option value="bbl">bbl (oil)</option>
            <option value="galUS">gal (US)</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Measured Temperature (T)</label>
          <input id="T" type="number" step="any" placeholder="e.g. 28">
          <div class="hint">°C</div>
        </div>
        <div>
          <label>Reference Temperature (T<sub>ref</sub>)</label>
          <input id="Tref" type="number" step="any" value="15">
          <div class="hint">°C (typical 15 °C)</div>
        </div>
      </div>

      <div class="row">
        <div>
          <label>CTL Mode</label>
          <select id="ctlMode">
            <option value="approx">Approx (using α)</option>
            <option value="manual">Manual CTL (from API/ASTM tables)</option>
          </select>
        </div>
        <div id="alphaBox">
          <label>Thermal Expansion Coefficient (α)</label>
          <input id="alpha" type="number" step="any" value="0.0007">
          <div class="hint">per °C (typical crude 0.00065–0.00085)</div>
        </div>
        <div id="ctlBox" style="display:none">
          <label>CTL (manual)</label>
          <input id="CTL" type="number" step="any" placeholder="e.g. 0.98523">
          <div class="hint">From API MPMS 11.1 / ASTM D1250 tables</div>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Density @ Reference (optional)</label>
          <input id="rho" type="number" step="any" placeholder="e.g. 840">
          <div class="hint">kg/m³ at T<sub>ref</sub></div>
        </div>
        <div>
          <label>HHV (optional)</label>
          <input id="hhv" type="number" step="any" placeholder="e.g. 44">
          <div class="hint">MJ/kg</div>
        </div>
      </div>

      <div class="flex" style="margin-top:10px">
        <button class="btn" id="btnCalc">Calculate</button>
        <button class="btn" id="btnExport">Export .xlsx</button>
        <button class="btn" id="btnReset" style="background:#0ea5e9">Reset</button>
        <div class="muted">Approx CTL uses CTL ≈ exp[-α (T−Tref)]. For custody billing use official table values.</div>
      </div>
    </div>

    <div class="card">
      <div class="row-3">
        <div>
          <label>CTL used</label>
          <div id="outCTL" class="out">—</div>
        </div>
        <div>
          <label>Corrected Volume (V<sub>corr</sub>)</label>
          <div id="outVcorr" class="out">—</div>
        </div>
        <div>
          <label>Unit (V)</label>
          <div id="outUnit" class="out">—</div>
        </div>
      </div>
      <div class="row" style="margin-top:12px">
        <div>
          <label>Mass (optional)</label>
          <div id="outMass" class="out">—</div>
          <div class="hint">Shown if density provided</div>
        </div>
        <div>
          <label>Energy (optional)</label>
          <div id="outEnergy" class="out">—</div>
          <div class="hint">Shown if density & HHV provided</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="title" style="font-size:1.05rem;margin:0 0 10px">Standards & Reference Documents</div>
      <div class="row">
        <div>
          <label>Choose a document</label>
          <select id="docSelect"></select>
          <div class="hint">Public links to foundational custody & calibration documents</div>
        </div>
        <div style="display:flex;align-items:end">
          <button class="btn" id="openDoc">Open</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="title" style="font-size:1.05rem;margin:0 0 10px">Notes</div>
      <ul class="muted" style="margin:0 0 6px 18px;line-height:1.5">
        <li><b>V<sub>corr</sub> = V × CTL</b>. If you have table CTL, choose “Manual”.</li>
        <li>Approximate CTL uses <b>CTL ≈ exp[-α (T - Tref)]</b>. Good for small ΔT.</li>
        <li>Mass = V<sub>corr</sub> (m³) × ρ<sub>ref</sub> (kg/m³). Energy = Mass × HHV.</li>
        <li>For custody billing, use official API/ASTM/OIML procedures.</li>
      </ul>
    </div>
  </div>

  <!-- Modal: Disclaimers & Standards -->
  <div id="modal" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <header>
        <div id="modalTitle" class="title" style="margin:0;font-size:1.1rem">Disclaimers, Standards & Methodology</div>
        <button class="close" id="btnClose">Close</button>
      </header>
      <div class="content">
        <h3 style="margin:.2rem 0 .4rem 0">What this calculator is</h3>
        <p>This tool estimates corrected liquid volume at a reference temperature (typically 15&nbsp;°C), and optionally mass and energy, for field use and pre-checks.</p>

        <h3 style="margin:.8rem 0 .4rem 0">How CTL is handled</h3>
        <ul>
          <li><b>Manual CTL:</b> Enter the table value from your licensed API MPMS 11.1 / ASTM D1250 resource (recommended for custody).</li>
          <li><b>Approx CTL:</b> Uses <code>CTL ≈ exp[-α (T − Tref)]</code> with user-supplied thermal expansion coefficient α (per °C). Suitable for small ΔT estimates only.</li>
        </ul>

        <h3 style="margin:.8rem 0 .4rem 0">Assumptions</h3>
        <ul>
          <li>Single-phase, homogeneous liquid hydrocarbons; no entrained gas or free water unless accounted in separate net calculations.</li>
          <li>Reference density is provided at the same reference temperature.</li>
          <li>No pressure correction applied (this tool does not compute CPL/CTPL).</li>
        </ul>

        <h3 style="margin:.8rem 0 .4rem 0">Limitations</h3>
        <ul>
          <li>Not a substitute for licensed implementations of API MPMS Chapter 11.1 / ASTM D1250 (2004 and later).</li>
          <li>Approximate mode may deviate from official table values, especially at large temperature differentials or outside typical density ranges.</li>
          <li>Does not cover LPG/NGLs, LNG/cryogenics, multiphase flow, slurries, emulsions, or gas compressibility calculations.</li>
        </ul>

        <h3 style="margin:.8rem 0 .4rem 0">Meters not covered by this calculator</h3>
        <ul>
          <li>Gas meters (orifice/ultrasonic/Coriolis for gas) requiring AGA/API gas standards and compressibility (AGA 8).</li>
          <li>Any measurement requiring pressure correction (CPL/CTPL) or density conversion outside liquid hydrocarbon scope.</li>
        </ul>

        <h3 style="margin:.8rem 0 .4rem 0">Key standards referenced (see dropdown for links)</h3>
        <ul>
          <li>API MPMS Chapter 11.1 / ASTM D1250 (Temperature &amp; Pressure Volume Correction Factors).</li>
          <li>OIML R117 for liquid measuring systems.</li>
          <li>ISO 5167 (differential pressure flow measurement – general principles).</li>
          <li>AGA 3 (orifice), AGA 11 (Coriolis for gas), API MPMS 4.8 (proving systems), API MPMS 5.6 (Coriolis for liquids).</li>
        </ul>

        <h3 style="margin:.8rem 0 .4rem 0">Disclaimer</h3>
        <p>This estimator is provided “as is” for engineering guidance. For custody transfer, audits, and billing, follow your governing contracts, calibration certificates, and the official standards referenced.</p>
      </div>
    </div>
  </div>

  <div class="footer">
    <div>this is a copywrite by Asanloop Sdn Bhd Malaysia. all rights reserved etc.</div>
    <div style="margin-top:6px">
      Website: <a href="https://asian-loop.com" target="_blank" rel="noopener">asian-loop.com</a> •
      LinkedIn: <a href="https://www.linkedin.com/company/asianloop-sdn-bhd" target="_blank" rel="noopener">Asianloop Sdn Bhd</a>
    </div>
  </div>
</body>
</html>
