
(function(global){
  async function initAGA8(wasmPath){
    if(global.AGA8 && global.AGA8.ready) return global.AGA8;
    const path = wasmPath || (global.AGA8_WASM_URL || "/vendor/aga8/aga8.wasm");
    const response = await fetch(path);
    const bytes = await response.arrayBuffer();
    const { instance } = await WebAssembly.instantiate(bytes, {});
    // For demo: we only expose a fake detail function (replace with real if you have it)
    const api = {
      ready:true,
      PropertiesDetailPT: function(P_psia, T_R, comp){
        // stub: return Papay-like result just so it runs
        const Z = 0.9 + 0.05*Math.random(); // fake value for now
        return { Z: Z };
      }
    };
    global.AGA8 = api;
    return api;
  }
  // expose
  global.AGA8wasm = initAGA8;
})(typeof window!=='undefined'?window:this);
